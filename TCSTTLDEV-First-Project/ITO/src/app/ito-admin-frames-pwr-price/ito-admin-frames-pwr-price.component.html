<h4 style=" margin-left: 102px; color: gray; font-size:20px; margin-top: 0px;">
    Update Cost - UBO
</h4>
<div class="UBOContainer">

    <div *ngIf="hideprogress" style="margin-left:40%;margin-top:10%;">
        <p-progressSpinner></p-progressSpinner>
    </div>

    <div *ngIf="!hideprogress">
        <p-tabView (onChange)="handleChange($event)">
            <p-tabPanel header=" Update Price" leftIcon="fa fa-pencil-square-o">
                <div class="userCreation" *ngIf="dispDropdown">
                    <div>
                        <div class="reqStyl">
                            <label>Type of Blade
                                <span class="asterisk_input">*</span>
                            </label>
                            <select class="widthInc" required ngModel name="turbineDesign" #turbineDesign="ngModel" (change)="TDSel(turbineDesign.value)">
                                <option value="" hidden selected>Please select</option>
                                <option [ngValue]="turbDesign.categoryDetCode" *ngFor="let turbDesign of turbineDesignArray">{{turbDesign.categoryDetDesc}}</option>
                            </select>
                        </div>

                        <div class="reqStyl">
                            <label>Turbine Type
                                <span class="asterisk_input">*</span>
                            </label>
                            <select class="widthInc" required ngModel name="turbineType" #turbineType="ngModel" (change)="TOTSel(turbineType.value)">
                                <option value="" hidden selected>Please select</option>
                                <option [ngValue]="turbType.categoryDetCode" *ngFor="let turbType of turbineTypeArray">{{turbType.categoryDetDesc}}</option>
                            </select>
                        </div>

                        <div class="reqStyl" *ngIf="displayCond">
                            <label>Condensor Type
                                <span class="asterisk_input">*</span>
                            </label>
                            <select class="widthInc" required ngModel name="condType" #condType="ngModel" (change)="CondSel(condType.value)">
                                <option value="" hidden selected>Please select</option>
                                <option [ngValue]="cond.categoryDetId" *ngFor="let cond of condensorTypes">{{cond.categoryDetDesc}}</option>
                            </select>
                        </div>

                        <!-- *ngIf="displayBleed" -->
                        <div class="reqStyl">
                            <label>Type of Bleed
                                <span class="asterisk_input">*</span>
                            </label>
                            <select class="widthInc" required ngModel name="bleedTyp" #bleedTyp="ngModel" value="bleedTyp.categoryDetId" (change)="bleedTypSelChange(bleedTyp.value)">
                                <option value="" hidden selected>Please select</option>
                                <option [ngValue]="bleedTyp.categoryDetId" *ngFor="let bleedTyp of bleedTypArray">{{bleedTyp.categoryDetDesc}}</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <div class="reqStyl">
                            <label>Frames
                                <span class="asterisk_input">*</span>
                            </label>
                            <select class="widthInc" required ngModel name="frame" #frame="ngModel" (focus)="focusFunction()" (change)="FrameSelChange(frame.value)">
                                <option value="" hidden selected>Please select</option>
                                <option [ngValue]="frames.frameId" *ngFor="let frames of frameDrpDowns">{{frames.frameDesc}}</option>
                            </select>
                        </div>
                        <div class="reqStyl">
                            <label>Frame Power
                                <span class="asterisk_input">*</span>
                            </label>
                            <select class="widthInc" required ngModel name="framePwr" #framePwr="ngModel" value="framesPwr.frameDesc" (change)="FramePwrSelChange(framePwr.value)">
                                <option value="" hidden selected>Please select</option>
                                <option [ngValue]="framesPwr.framePowerId" [selected]="framesPwr.defaultVal" *ngFor="let framesPwr of frmPowerArray">{{framesPwr.maximumPower}} (MW)</option>
                            </select>
                            <p-progressSpinner [hidden]="!hidespinner" [style]="{width: '25px', height: '25px', float: 'right', bottom: '25px'}" strokeWidth="5" fill="#EEEEEE" animationDuration=".5s"></p-progressSpinner>
                        </div>
                    </div>
                </div>
                
                <div *ngIf="!dispDropdown">
                    <div class="frameDet">
                        <label>
                            Frame Name:
                        </label>
                        <label>
                            {{framePowerName}}
                        </label>
                    </div>
                    <div class="frameDet">
                        <label>
                            Blade Type :
                        </label>
                        <label>
                            {{turbineDesign}}
                        </label>
                    </div>
                    <div class="frameDet">
                        <label>
                            Turbine Type :
                        </label>
                        <label>
                            {{turbineType}}
                        </label>
                    </div>
                    <div class="frameDet">
                        <label>
                            Condensing Type :
                        </label>
                        <label>
                            {{condName}}
                        </label>
                    </div>
                    <div class="frameDet">
                        <label>
                            Frame Power :
                        </label>
                        <label>
                            {{frmPower}} (MW)
                        </label>
                    </div>
                    <div class="frameDet">
                        <label>
                            Bleed Type :
                        </label>
                        <label>
                            {{bleedType}}
                        </label>
                    </div>
                </div>
                <div style="margin-top: 170px;" *ngIf="showNoCostMsg">
                    <label class="successMsg">Cost is Not available for the selected Frame .</label>
                </div>
                <div style="margin-top: 170px;" *ngIf="uboListArray.length>0">

                    <!-- <div *ngFor="let catList of catListArray;let i=index;" (click)="catoryList(catList,i);">
                    <button class="collapsible">
                        <label class="catNmDsply">{{catList.cat_NM}} </label>
                        <label class="countDsply">{{indtotl[i]}}</label> 
                    </button>-->

                    <p-table #dt [tableStyle]="{'width': '80%' , 'margin-left':'5%'}" [value]="uboListArray" dataKey="cat_ID">
                        <ng-template pTemplate="header">
                            <tr>
                                <th>Material Name</th>
                                <th>Category Code</th>
                                <th>Sub-Category Code</th>
                                <th>Cost</th>
                                <th *ngIf="enablePrevPrice">Previous Cost</th>
                            </tr>
                        </ng-template>

                        <ng-template *ngIf="!enablePrevPrice" pTemplate="body" let-rowData let-rowIndex="rowIndex" let-expanded="expanded" let-columns="columns">
                            <tr *ngIf="rowGroupMetadata[rowData.cat_ID].index === rowIndex">
                                <td colspan="4" style="padding: 8px;font-size: 14px;">
                                    <a href="#" [pRowToggler]="rowData">
                                        <i [ngClass]="expanded ? 'fa fa-fw fa-chevron-circle-down' : 'fa fa-fw fa-chevron-circle-right'"></i>
                                        <span>
                                            <b>{{rowData.cat_NM}}</b>
                                        </span>
                                    </a>
                                    <label class="countDsply">{{rowData.matPrice}}</label>
                                </td>
                            </tr>
                        </ng-template>
                        <ng-template *ngIf="enablePrevPrice" pTemplate="body" let-rowData let-rowIndex="rowIndex" let-expanded="expanded" let-columns="columns">
                            <tr *ngIf="rowGroupMetadata[rowData.cat_ID].index === rowIndex">
                                <td colspan="5" style="padding: 8px;">
                                    <a href="#" [pRowToggler]="rowData">
                                        <i [ngClass]="expanded ? 'fa fa-fw fa-chevron-circle-down' : 'fa fa-fw fa-chevron-circle-right'"></i>
                                        <span>{{rowData.cat_NM}}</span>
                                    </a>
                                    <label class="countDsply"> {{rowData.matPrice}}</label>
                                </td>
                            </tr>
                        </ng-template>

                        <ng-template pTemplate="rowexpansion" let-rowData let-rowIndex="rowIndex">
                            <tr id="{{rowData.f2F_DET_ID}}">
                                <td>{{rowData.mtrl_NM}}</td>
                                <td>{{rowData.mtrl_CD}}</td>
                                <td>{{rowData.mtrl_CD}}</td>

                                <td pEditableColumn>
                                    <p-cellEditor>
                                        <ng-template pTemplate="input">
                                            <input (change)="savePrice(rowData)" pInputText type="number" [(ngModel)]="rowData.price">
                                        </ng-template>
                                        <ng-template pTemplate="output">
                                            {{rowData.price}}
                                        </ng-template>
                                    </p-cellEditor>
                                </td>
                                <td *ngIf="enablePrevPrice">{{rowData.previousPrice}}</td>
                            </tr>
                        </ng-template>
                    </p-table>
                    <!-- <div class="ui-dialog-buttonpane ui-helper-clearfix">
                        <button type="button" pButton icon="fa fa-check" (click)="save()" label="Save"></button>
                    </div> -->
                </div>
            </p-tabPanel>
            <p-tabPanel header="Add Price" leftIcon="fa fa-plus-square">
                <div class="userCreation" *ngIf="dispDropdown">
                    <div>
                        <div class="reqStyl">
                            <label>Type of Blade
                                <span class="asterisk_input">*</span>
                            </label>
                            <select class="widthInc" required ngModel name="turbineDesign" #turbineDesign="ngModel" value="turbDesign.categoryDetDesc"
                                (change)="TDSel(turbineDesign.value)">
                                <option value="" hidden selected>Please select</option>
                                <option [ngValue]="turbDesign.categoryDetCode" *ngFor="let turbDesign of turbineDesignArray">{{turbDesign.categoryDetDesc}}</option>
                            </select>
                        </div>
                        <div class="reqStyl">
                            <label>Turbine Type
                                <span class="asterisk_input">*</span>
                            </label>
                            <select class="widthInc" required ngModel name="turbineType" #turbineType="ngModel" value="turbType.categoryDetDesc" (change)="TurbineTypeSel(turbineType.value)">
                                <option value="" hidden selected>Please select</option>
                                <option [ngValue]="turbType.categoryDetCode" *ngFor="let turbType of turbineTypeArray">{{turbType.categoryDetDesc}}</option>
                            </select>
                        </div>
                        <!-- *ngIf="displayBleed" -->
                        <div class="reqStyl">
                            <label>Type of Bleed
                                <span class="asterisk_input">*</span>
                            </label>
                            <select class="widthInc" required ngModel name="bleedTyp" #bleedTyp="ngModel" value="bleedTyp.categoryDetId" (change)="bleedTypSelChange(bleedTyp.value)">
                                <option value="" hidden selected>Please select</option>
                                <option [ngValue]="bleedTyp.categoryDetId" *ngFor="let bleedTyp of bleedTypArray">{{bleedTyp.categoryDetDesc}}</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <div class="reqStyl">
                            <label>Frames
                                <span class="asterisk_input">*</span>
                            </label>
                            <select class="widthInc" required ngModel name="frame" #frame="ngModel" (change)="getFrameDet(frame.value)">
                                <option value="" hidden selected>Please select</option>
                                <option [ngValue]="frames.framePowerId" *ngFor="let frames of tempFrameArray">{{frames.frameDesc}}</option>
                            </select>
                        </div>
                    </div>
                </div>
            </p-tabPanel>
        </p-tabView>
        <form #updateUBOPriceForm="ngForm" *ngIf="uboListArray.length>0" (ngSubmit)="updateUBOPrice(updateUBOPriceForm.value,updateUBOPriceForm)">
            <table id="comments" class="uboComment">
                <tr *ngFor="let c of prevRemarks;let i=index;">
                    <td>
                        <label>
                            <b>{{c.assingedToname}} - Comments</b>
                        </label>
                    </td>
                    <td>
                        <textarea class="pcomments" disabled placeholder="Remarks" cols="50" rows="2">{{c.comment}}</textarea>
                    </td>
                </tr>
                <tr>
                    <td>
                        <label>
                            <b>Comments
                                <span class="asterisk_input">*</span>
                            </b>
                        </label>
                    </td>
                    <td>
                        <textarea required #remarks="ngModel" name="remarks" cols="50" rows="2" ngModel class="remarks" placeholder="Enter your Remarks"></textarea>
                    </td>
                </tr>
                <tr *ngIf="(UBOApprove || UBOReview)">
                    <td>
                        <label>
                            <b>Accept / Reject the update request here
                                <span class="asterisk_input">*</span>
                            </b>
                        </label>
                    </td>
                    <td>
                        <select class="priceField" #state="ngModel" required name="status" ngModel #status="ngModel" (change)="statusSel(status.value)">
                            <option value="" selected hidden>Please select </option>
                            <option>Accept</option>
                            <option>Reject</option>
                        </select>
                    </td>
                </tr>
                <tr *ngIf="(UBOEdit || UBOReview) && (enableStatus) ">
                    <td>
                        <label>
                            <b>{{labelName}}</b>
                        </label>
                        <span class="asterisk_input">*</span>
                    </td>
                    <td>
                        <select required class="widthInc" ngModel name="assignee" #assignee>
                            <option value="" hidden selected> Please select</option>
                            <option [ngValue]="u.userId" *ngFor="let u of newUsersList">{{u.empName}}</option>
                        </select>
                    </td>
                </tr>

            </table>

            <div class="previouFun">
                <button class="updateTrans" [disabled]="updatedUBOList.length==0" (click)="SaveAsDraft(updateUBOPriceForm.value,updateUBOPriceForm)" type="button">Save As Draft</button>
                <button style="margin-left: 25px;" class="updateTrans" id="updateReq" [disabled]="!(updateUBOPriceForm.form.valid && updatedUBOList.length!=0)" type="submit">Submit</button>
            </div>
        </form>
        <!-- <div *ngIf="message" class="msgDiv">
            {{successMsg}}
        </div>
        <div *ngIf="updMessage" class="msgDiv">
            {{updSuccessMsg}}
        </div> -->
        <p-dialog header="Request Status" [(visible)]="message" [responsive]="true" showEffect="fade" [modal]="true" [width]="400">
            <label class="mesgDiv" *ngFor="let s of successMsg">{{s}}</label>
            <p-footer>
              <div class="ui-dialog-buttonpane ui-helper-clearfix">
                <button type="button" pButton icon="fa fa-check" (click)="closeMessage()" label="Ok"></button>
              </div>
            </p-footer>
          </p-dialog>
    </div>
</div>